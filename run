#!/bin/bash


function help() {
cat << EOF
Task runner

Usage:
    run [COMMAND] [ARGS...]

Commands:
    start               Setup a production environment
    start_dev           Setup a development environment
    translate           Generate and compile translations

If an unknown command is specified, it will be passed to docker-compose. e.g:
    run up -d
    run logs
    run exec django bash

EOF
}

function start(){
     docker-compose down
     docker-compose build
     docker-compose run --rm sass node-sass scss/ -o css/
     docker-compose run --rm django python3 manage.py collectstatic --no-input
     docker-compose up -d
}

function start_dev(){
     docker-compose -f docker-compose.yml -f docker-compose.dev.yml down
     docker-compose -f docker-compose.yml -f docker-compose.dev.yml build
     docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d
}

function shell(){
     docker-compose run --rm django /bin/bash
}


function manage(){
    docker-compose run --rm --no-deps django python3 manage.py "$@"
}

function translate(){
    manage render_translation_vars
    docker-compose run --rm django python3 manage.py makemessages -l en
    docker-compose run --rm django python3 manage.py makemessages --all
    docker-compose run --rm django python3 manage.py compilemessages
}


if [ $# -eq 0 ]; then
    help
elif [ "$(type -t $1)" == 'function' ]; then
    func=$1
    shift
    $func "$@"
else
    docker-compose "$@"
fi